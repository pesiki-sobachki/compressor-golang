# –°–µ—Ä–≤–∏—Å –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –Ω–∞ Go

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–∂–∞—Ç–∏—è –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ Go.

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö **–ì–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (Ports and Adapters)** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `libvips` —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç `bimg` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∏ —ç–∫–æ–Ω–æ–º–Ω–æ–π –ø–æ –ø–∞–º—è—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:**

1. **Storage Mode:** —Å–∂–∞—Ç–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞ –¥–∏—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞.
2. **Streaming Mode:** —Å–∂–∞—Ç–∏–µ ¬´–Ω–∞ –ª–µ—Ç—É¬ª (in‚Äëmemory) –∏ –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.
- **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤:** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ JPEG, PNG, WEBP.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –∑–∞—â–∏—Ç–∞ –æ—Ç Path Traversal –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤.
- **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫.
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ `/upload`, `/process` –∏ `/file` —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ —Ñ–∞–π–ª–æ–≤, –ø—É—Ç—è–º–∏ –∏ –∞–¥—Ä–µ—Å–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤.


## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º `Standard Go Project Layout` —Å –∞–¥–∞–ø—Ç–µ—Ä–∞–º–∏ –∏ –¥–æ–º–µ–Ω–æ–º –≤ `internal/`.

```text
/
‚îú‚îÄ‚îÄ Makefile                          # –°–±–æ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (make deps/build/run)
‚îú‚îÄ‚îÄ compressor/
‚îÇ   ‚îî‚îÄ‚îÄ api.go                        # –ü—É–±–ª–∏—á–Ω—ã–π —Ñ–∞—Å–∞–¥ –∏ DTO –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ main.go                   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (HTTP-—Å–µ—Ä–≤–µ—Ä)
‚îú‚îÄ‚îÄ config.yaml                       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HTTP, storage, log, image
‚îú‚îÄ‚îÄ go.mod                            # –ú–æ–¥—É–ª—å –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Go
‚îú‚îÄ‚îÄ go.sum                            # –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã –º–æ–¥—É–ª–µ–π Go
‚îî‚îÄ‚îÄ internal/
    ‚îú‚îÄ‚îÄ adapter/                      # –ê–¥–∞–ø—Ç–µ—Ä—ã (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ä—Ç–æ–≤)
    ‚îÇ   ‚îú‚îÄ‚îÄ inbound/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ http/
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ handler.go        # HTTP-—Ö–µ–Ω–¥–ª–µ—Ä—ã (REST API)
    ‚îÇ   ‚îî‚îÄ‚îÄ outbound/
    ‚îÇ       ‚îú‚îÄ‚îÄ processor/
    ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ bimg/
    ‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ processor.go  # –ê–¥–∞–ø—Ç–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (libvips/bimg)
    ‚îÇ       ‚îî‚îÄ‚îÄ repository/
    ‚îÇ           ‚îî‚îÄ‚îÄ local/
    ‚îÇ               ‚îú‚îÄ‚îÄ pathvalidator/
    ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ validator.go  # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç Path Traversal
    ‚îÇ               ‚îî‚îÄ‚îÄ storage.go        # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îú‚îÄ‚îÄ config.go                 # –°—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (HTTP, Storage, Log, Image)
    ‚îÇ   ‚îî‚îÄ‚îÄ loader.go                 # –ó–∞–≥—Ä—É–∑–∫–∞ config.yaml
    ‚îú‚îÄ‚îÄ logger/
    ‚îÇ   ‚îî‚îÄ‚îÄ logger.go                 # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–≥–µ—Ä–∞
    ‚îî‚îÄ‚îÄ core/                         # –î–æ–º–µ–π–Ω –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
        ‚îú‚îÄ‚îÄ domain/
        ‚îÇ   ‚îî‚îÄ‚îÄ file.go               # –ú–æ–¥–µ–ª–∏ –¥–æ–º–µ–Ω–∞ (—Ñ–∞–π–ª, –æ–ø—Ü–∏–∏ —Å–∂–∞—Ç–∏—è –∏ —Ç.–ø.)
        ‚îú‚îÄ‚îÄ port/
        ‚îÇ   ‚îú‚îÄ‚îÄ processor.go          # –ü–æ—Ä—Ç—ã –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        ‚îÇ   ‚îî‚îÄ‚îÄ repository.go         # –ü–æ—Ä—Ç—ã –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Ñ–∞–π–ª–æ–≤
        ‚îî‚îÄ‚îÄ service/
            ‚îî‚îÄ‚îÄ compression.go        # –°–µ—Ä–≤–∏—Å—ã —Å–∂–∞—Ç–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
```


## üì¶ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `config.yaml` –∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

```yaml
http:
  address: ":8080"
  max_upload_size_mb: 20
  read_timeout: "10s"
  write_timeout: "15s"
  idle_timeout: "60s"

storage:
  path: "./storage"
  compressed_subdir: "compressed"
  tmp_subdir: "tmp"

log:
  level: "info"          # trace, debug, info, warn, error, fatal, panic, disabled
  service: "compressor"  # –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –≤ –ª–æ–≥–∞—Ö
  console: true          # –≤—ã–≤–æ–¥ –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª—å
  json_output: false     # —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π –≤—ã–≤–æ–¥

image:
  default_format: "jpeg"
  default_quality: 50
  max_width: 3840
  max_height: 2160
  allow_formats:
    - "jpeg"
    - "png"
    - "webp"
```

–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- `http.max_upload_size_mb` –∑–∞–¥–∞—ë—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤—Ö–æ–¥—è—â–µ–≥–æ —Ñ–∞–π–ª–∞; –≤ –∫–æ–¥–µ –æ–Ω –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –±–∞–π—Ç—ã –∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç `r.Body` —á–µ—Ä–µ–∑ `http.MaxBytesReader`.

```
- `storage.path` –∏ `storage.compressed_subdir` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø—É—Ç–∏ `storage/compressed/<uuid>.<ext>`.  
```

- `log.console: true` –≤–∫–ª—é—á–∞–µ—Ç –≤—ã–≤–æ–¥ –≤—Å–µ—Ö –ª–æ–≥–æ–≤ –≤ stdout; `json_output: false` ‚Äî —É–¥–æ–±–Ω—ã–π –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç.
- `image.default_*` –∑–∞–¥–∞—é—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –æ–ø—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ –∑–∞–ø—Ä–æ—Å–µ.


### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

–ü—Ä–æ–µ–∫—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ Linux (Ubuntu / Debian, –≤–∫–ª—é—á–∞—è WSL2) –∏ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ `libvips` –∏ CGO.

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–∏—Å—Ç–µ–º–Ω—ã–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º ‚Äî –≤ [`INSTALL.md`](./INSTALL.md).

–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/pesiki-sobachki/compressor-golang.git
cd compressor-golang

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏ Go-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (libvips, build-essential, –º–æ–¥—É–ª–∏ Go)
make deps

# –°–æ–±–∏—Ä–∞–µ–º –±–∏–Ω–∞—Ä–Ω–∏–∫ –≤ ./bin/api
make build

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
make run
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é HTTP‚Äë—Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç `8080`, –∑–∞–¥–∞—ë—Ç—Å—è `http.address` –≤ `config.yaml`.

## üõ† HTTP API

–°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ `http://localhost:8080` –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞.

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (Storage Mode)

`POST /upload`

–°–∂–∏–º–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –Ω–∞ –¥–∏—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (multipart/form-data):**

- `file` ‚Äî —Ñ–∞–π–ª (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).
- `format` ‚Äî `jpeg` | `png` | `webp` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `image.default_format`, —Å–µ–π—á–∞—Å `jpeg`).
- `quality` ‚Äî `1-100` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `image.default_quality`, —Å–µ–π—á–∞—Å `50`, –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–æ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ).

**–ü—Ä–∏–º–µ—Ä:**

```bash
curl -X POST http://localhost:8080/upload \
  -F "file=@/path/to/photo.jpg" \
  -F "format=webp" \
  -F "quality=80"
```

**–û—Ç–≤–µ—Ç (JSON):**

```json
{
  "status": "success",
  "compressed_path": "storage/compressed/<uuid>.jpeg",
  "message": "File saved successfully"
}
```

–ü–æ–ª–µ `compressed_path` ‚Äî —ç—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `/file`.

***

### 2. –°–∂–∞—Ç–∏–µ ¬´–Ω–∞ –ª–µ—Ç—É¬ª (Streaming Mode)

`POST /process`

–°–∂–∏–º–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ –∏ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–µ–ª–µ –æ—Ç–≤–µ—Ç–∞ (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –¥–∏—Å–∫).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** —Ç–µ –∂–µ, —á—Ç–æ –∏ —É `/upload` (`file`, `format`, `quality`).

**–ü—Ä–∏–º–µ—Ä:**

```bash
curl -X POST http://localhost:8080/process \
  -F "file=@/path/to/photo.jpg" \
  -F "format=png" \
  -F "quality=80" \
  --output result.png
```

–û—Ç–≤–µ—Ç–æ–º –±—É–¥–µ—Ç –±–∏–Ω–∞—Ä–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∂–∞—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ `Content-Type`, `Content-Length` –∏ `Content-Disposition`.

***

### 3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞

`GET /file`

–°–∫–∞—á–∏–≤–∞–µ—Ç —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–º—É –ø—É—Ç–∏ –∏–∑ `compressed_path`.

**Query‚Äë–ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `path` ‚Äî –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É (–∑–Ω–∞—á–µ–Ω–∏–µ `compressed_path`, –Ω–∞–ø—Ä–∏–º–µ—Ä `storage/compressed/<uuid>.jpeg`).

**–ü—Ä–∏–º–µ—Ä:**

```bash
curl -v "http://localhost:8080/file?path=storage/compressed/<uuid>.jpeg" \
  --output downloaded.jpeg
```

–ï—Å–ª–∏ –ø—É—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω (Path Traversal –∏ —Ç.–ø.), –≤–µ—Ä–Ω—ë—Ç—Å—è `400 Bad Request`. –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω ‚Äî `404 Not Found`.

## üìö –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

–ü–æ–º–∏–º–æ HTTP‚Äë—Å–µ—Ä–≤–∏—Å–∞, –ø—Ä–æ–µ–∫—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ Go‚Äë–±–∏–±–ª–∏–æ—Ç–µ–∫—É (—á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç `compressor`), —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä—è–º–æ –∏–∑ —Å–≤–æ–µ–≥–æ –∫–æ–¥–∞.

–ü—Ä–∏–º–µ—Ä (–∞–¥–∞–ø—Ç–∏—Ä—É–π `module` –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–π `go.mod`):

```go
package main

import (
    "os"

    "github.com/andreychano/compressor-golang/compressor"
)

func main() {
    // –°–æ–∑–¥–∞—ë–º –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (bimg + –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ).
    comp := compressor.NewDefault("./storage")

    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª.
    f, err := os.Open("input.jpg")
    if err != nil {
        panic(err)
    }
    defer f.Close()

    // –ó–∞–¥–∞—ë–º –æ–ø—Ü–∏–∏ —Å–∂–∞—Ç–∏—è.
    opts := compressor.Options{
        Format:    "webp", // —Ü–µ–ª–µ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç
        Quality:   80,     // –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç 1 –¥–æ 100
        MaxWidth:  0,      // 0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —à–∏—Ä–∏–Ω–µ
        MaxHeight: 0,      // 0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—ã—Å–æ—Ç–µ
    }

    // –í—ã–ø–æ–ª–Ω—è–µ–º —Å–∂–∞—Ç–∏–µ.
    data, meta, err := comp.Compress(f, opts)
    if err != nil {
        panic(err)
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∞–π–ª.
    if err := os.WriteFile("output.webp", data, 0o644); err != nil {
        panic(err)
    }

    _ = meta // meta.MimeType, meta.Size –∏ —Ç.–ø.
}
```
