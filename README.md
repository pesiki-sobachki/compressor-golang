# –°–µ—Ä–≤–∏—Å –∫–æ–º–ø—Ä–µ—Å–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –Ω–∞ Go
  

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–∂–∞—Ç–∏—è –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ Go.

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö **–ì–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (Ports and Adapters)** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `libvips` —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç `bimg` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∏ —ç–∫–æ–Ω–æ–º–Ω–æ–π –ø–æ –ø–∞–º—è—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

  

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

  

-  **–î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:**
    1.  **Storage Mode:** —Å–∂–∞—Ç–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞ –¥–∏—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞.
    2.  **Streaming Mode:** —Å–∂–∞—Ç–∏–µ ¬´–Ω–∞ –ª–µ—Ç—É¬ª (in‚Äëmemory) –∏ –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.

-  **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤:** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ JPEG, PNG, WEBP.

-  **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –∑–∞—â–∏—Ç–∞ –æ—Ç Path Traversal –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤.

-  **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫.
  

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

  

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º `Standard Go Project Layout`.

  

```text
/
‚îú‚îÄ‚îÄ INSTALL.md                       # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∑–∞–ø—É—Å–∫—É
‚îú‚îÄ‚îÄ Makefile                         # –°–±–æ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (make deps/build/run)
‚îú‚îÄ‚îÄ README.md                        # –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ API
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ main.go                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (HTTP-—Å–µ—Ä–≤–µ—Ä)
‚îú‚îÄ‚îÄ go.mod                           # –ú–æ–¥—É–ª—å –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Go
‚îú‚îÄ‚îÄ go.sum                           # –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã –º–æ–¥—É–ª–µ–π Go
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ adapter/                     # –ê–¥–∞–ø—Ç–µ—Ä—ã (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ä—Ç–æ–≤)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inbound/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ http/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ handler.go       # HTTP-—Ö–µ–Ω–¥–ª–µ—Ä—ã (REST API)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outbound/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ processor/
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ bimg/
‚îÇ   ‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ processor.go # –ê–¥–∞–ø—Ç–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (libvips/bimg)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ repository/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ local/
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ pathvalidator/
‚îÇ   ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ validator.go  # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç Path Traversal
‚îÇ   ‚îÇ               ‚îî‚îÄ‚îÄ storage.go        # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îÇ   ‚îî‚îÄ‚îÄ core/                        # –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏ –ø–æ—Ä—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ domain/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ file.go              # –ú–æ–¥–µ–ª–∏ –¥–æ–º–µ–Ω–∞ (—Ñ–∞–π–ª, –æ–ø—Ü–∏–∏ —Å–∂–∞—Ç–∏—è –∏ —Ç.–ø.)
‚îÇ       ‚îú‚îÄ‚îÄ port/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ processor.go         # –ü–æ—Ä—Ç—ã –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ repository.go        # –ü–æ—Ä—Ç—ã –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Ñ–∞–π–ª–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ service/
‚îÇ           ‚îî‚îÄ‚îÄ compression.go       # –°–µ—Ä–≤–∏—Å—ã —Å–∂–∞—Ç–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
‚îî‚îÄ‚îÄ pkg/
    ‚îî‚îÄ‚îÄ test.go                      # –ü—É–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã
```

  

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

  

–ü—Ä–æ–µ–∫—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ Linux (Ubuntu / Debian, –≤–∫–ª—é—á–∞—è WSL2) –∏ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ `libvips` –∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–≥–æ CGO.

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ [`INSTALL.md`](./INSTALL.md).

  

–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:

  
**–ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
```
git clone https://github.com/pesiki-sobachki/compressor-golang.git
```
```bash
cd compressor-golang
```
**–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏ Go-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (libvips, build-essential, –º–æ–¥—É–ª–∏ Go)**
```bash
make deps
```
**–°–æ–±–∏—Ä–∞–µ–º –±–∏–Ω–∞—Ä–Ω–∏–∫ –≤ ./bin/api**
```bash
make build
```
**–ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä**
```bash
make run
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é HTTP‚Äë—Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç `8080` (–º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è).

  

## üõ† API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

  

–°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É `:8080` –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç HTTP‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏.

  

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (Storage Mode)

  

`POST /upload`

–°–∂–∏–º–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –Ω–∞ –¥–∏—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞.



**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (multipart/form-data):**

  

-  `image` ‚Äî —Ñ–∞–π–ª (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

-  `format` ‚Äî `jpeg` | `png` | `webp` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `jpeg`)

-  `quality` ‚Äî `1-100` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `80`)

  

**–ü—Ä–∏–º–µ—Ä:**

  

```bash
curl -X POST http://localhost:8080/upload \
  -F "image=@/path/to/photo.jpg" \
  -F "format=webp"
```

  

–û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∏ –ø—É—Ç—ë–º –∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É.

  

---

  

### 2. –°–∂–∞—Ç–∏–µ ¬´–Ω–∞ –ª–µ—Ç—É¬ª (Streaming Mode)

  

`POST /process`

–°–∂–∏–º–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ –∏ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–µ–ª–µ –æ—Ç–≤–µ—Ç–∞. –ù–∞ –¥–∏—Å–∫ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.
  

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** —Ç–µ –∂–µ, —á—Ç–æ –∏ —É `/upload`.

  

**–ü—Ä–∏–º–µ—Ä:**

  

```bash
curl -X POST http://localhost:8080/process \
  -F "image=@/path/to/photo.jpg" \
  -F "format=png" \
  --output result.png
```

  

---

  

### 3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞

  

`GET /file`

–°–∫–∞—á–∏–≤–∞–µ—Ç —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–º—É –ø—É—Ç–∏.

  

**Query‚Äë–ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

  

-  `path` ‚Äî –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É (–ø–æ–ª—É—á–µ–Ω–Ω—ã–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –æ—Ç–≤–µ—Ç–∞ `/upload`).

  

**–ü—Ä–∏–º–µ—Ä:**

```bash
curl -v "http://localhost:8080/file?path=compressed/uuid.webp" --output downloaded.webp
```


## üêõ –û—Ç–ª–∞–¥–∫–∞ –∏ –ø—Ä–æ–±–ª–µ–º—ã

  

–ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ `libvips`, `pkg-config` –∏ —Ç.–ø.) –∏ —Å–ø–æ—Å–æ–±—ã –∏—Ö —Ä–µ—à–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω—ã –≤ [`INSTALL.md`](./INSTALL.md).

–ü–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

  

```bash
make deps
```
```bash
make build
```
```bash
make run
```
